jQuery(document).ready(function(t){t("#tags").tagEditor({autocomplete:{delay:0,position:{collision:"flip"},source:[]},delimiter:",，",placeholder:"输入用户组，多个组以逗号分隔。也可以直接点击右边列表的复选项目选择"})}),jQuery(document).ready(function(t){function i(e,i){var a=[];e.each(function(){t(this).is(":checked")&&a.push(t(this).val())}),i.val(a.toString())}function a(t){var i=t||e,a=i.keyCode||i.which;return console.info(a),a>=48&&57>=a?!0:8==a||46==a?!0:!1}function o(t){var e=t.next("select.to"),i=e.children("option:selected").val(),a=t.children("option:selected").val();r(e,a,100),parseInt(a)<parseInt(i)&&e.children("option[value="+i+"]").prop("selected","selected")}function n(t){var e=t.prev("select.from"),i=t.children("option:selected").val(),a=e.children("option:selected").val();r(e,0,i),parseInt(a)<=parseInt(i)&&e.children("option[value="+a+"]").prop("selected","selected")}function l(t){var e=t.prev("input.from"),i=t.val(),a=e.val();parseInt(a)>parseInt(i)&&(t.val(parseInt(a)+1),alert("区间最大值不能小于最小值!"))}function r(t,e,i){t.html("");for(var a=e;i>=a;a++)t.append('<option value="'+a+'">'+a+"</option>")}function s(e,i){var a=e*i*.01;return a=a.toString(),t.formatFloat(a,2)}UM.getEditor("myEditor");t("#form-submit").click(function(){t("#edit-form").submit()}),t(".published_at").datetimepicker({lang:"ch",format:"Y-m-d H:i"}),t(".datetimepicker").datetimepicker({lang:"ch",format:"Y-m-d H:i"}),t("#datetimepicker_start").datetimepicker({lang:"ch",format:"Y-m-d H:i",onShow:function(e){this.setOptions({maxDate:t("#datetimepicker_end").val()?t("#datetimepicker_end").val():!1})}}),t("#datetimepicker_end").datetimepicker({lang:"ch",format:"Y-m-d H:i",onShow:function(e){this.setOptions({minDate:t("#datetimepicker_start").val()?t("#datetimepicker_start").val():!1})}}),t("#multiple-photo-upload").fileupload({url:mcmore.site_url+"/ajax/photo-upload",dataType:"json",formData:{resize_type:"fit"},dropZone:".file-upload-drop-zone",done:function(e,i){var a=i.result;t("#photo-warp").append('<div class="item">                <a class="corner" href="#">                    &times;                </a>                <img src="'+a.url+'">                <input name="images[]" type="hidden" value="'+a.id+'">            </div>')}}),t("#photo-upload").fileupload({url:mcmore.site_url+"/ajax/photo-upload",dataType:"json",formData:{},dropZone:"",done:function(e,i){var a=i.result;t("#photo-warp").empty(),t("#photo-warp").append('<div class="item">                <a class="corner" href="#">                    &times;                </a>                <img src="'+a.url+'">                <input name="image_id" type="hidden" id="image_id" ng-model="activity.image_id" value="'+a.id+'">            </div>')}}),t("#photo-warp").on("click",".corner",function(e){e.preventDefault(),t(this).closest(".item").remove()}),t("#photo-warp").sortable(),t("#add-option").on("click",function(){var e='<tr>            <td><input class="form-control" name="values[]" type="text" value="">            </td>            <td><a class="destroy-option btn btn-danger" href="javascript:void(0)">移除</a></td>        </tr>';t("#option-values").find("tbody").append(e)}),t("#option-values").on("click",".destroy-option",function(e){e.preventDefault(),t(this).closest("tr").remove()}),t(".destroy").on("click",function(e){e.preventDefault(),confirm("确定要删除记录！")&&t.ajax({url:t(this).attr("href"),dataType:"json",method:"POST",data:{_method:"DELETE"},success:function(){location.reload()}})}),t(".search span.more-filter").on("click",function(e){e.preventDefault(),t(this).closest(".search-top").next(".search-bottom").toggle()}),t("#datetimepicker1").datetimepicker({lang:"ch",format:"Y-m-d",timepicker:!1}),t("#datetimepicker2").datetimepicker({lang:"ch",format:"Y-m-d",timepicker:!1}),t("#datetimepicker3").datetimepicker({lang:"ch",format:"Y-m-d",timepicker:!1}),t("#datetimepicker4").datetimepicker({lang:"ch",format:"Y-m-d",timepicker:!1});var c=t(".son_checkbox");c.click(function(){i(c,t("#son_checkbox_ids"))}),t("input[type=checkbox].all-checkbox").click(function(){t(this).is(":checked")?(t(".son_checkbox").prop("checked","checked"),t("input[type=checkbox].all-choose").prop("checked","checked"),i(c,t("#son_checkbox_ids"))):(c.removeAttr("checked"),t("input[type=checkbox].all-choose").removeAttr("checked"),t("#son_checkbox_ids").val(""))}),t("select.add_to_group_select").change(function(){var e=t.trim(t("#son_checkbox_ids").val()),i=t.trim(t(this).val());""!=e?""!=i&&parseInt(i)>0?t.ajax({url:t(this).attr("url"),dataType:"json",method:"POST",data:{ids:e,group_id:i},success:function(t){console.info(t),1==t.result?location.reload():alert("系统错误!")}}):alert("请选择添加的组!"):alert("请选择要操作的记录!")}),t("select#province_select").change(function(){var e=t.trim(t(this).val());""!=e&&parseInt(e)>0&&(t("select#city_select").html(""),t.ajax({url:"/ajax/get-citys",dataType:"json",method:"POST",data:{province_id:e},success:function(e){e.length>0?(t("select#city_select").append('<option value="">--请选择市--</option>'),t.each(e,function(i){t("select#city_select").append("<option value='"+e[i].id+"'>"+e[i].name+"</option>")})):t("select#city_select").append('<option value="">--无下级市--</option>')}}))}),t("#myChart").length&&t("#myChart").highcharts({chart:{type:"spline"},title:{text:""},xAxis:{categories:pageview.categories},yAxis:{title:{text:"浏览量"}},series:pageview.series}),t(".certification_upload").each(function(e,i){t(this).fileupload({url:"/certification/upload_image",dataType:"json",formData:{attr_name:t(this).attr("attr_name"),relation_name:t(this).attr("relation_name")},done:function(e,i){var a=i.result;console.info(a),0==a.state?alert(a.msg):($image=t(this).next("img.thumb"),$image.size()>0?$image.attr("src",a.msg):(t(this).prev("input[type=hidden]").val(a.image_id),t(this).after(t('<img class="thumb" width="120" height="60" src="'+a.msg+'"/>'))))}})}),t("#comments").on("click",".show_reply",function(e){e.preventDefault();var i=t(this).attr("comment-id");t("#reply_"+i).toggle()}),t("input.open_distribute_switch").bootstrapSwitch(),t("input.open_distribute_switch").on("switchChange.bootstrapSwitch",function(t,e){location.href="/distributor/open_or_close"}),t(document).on("keypress","input.number",function(t){var i=t||e,a=i.keyCode||i.which;return console.info(a),a>=48&&57>=a?!0:8==a||46==a?!0:!1}),t("table.profit-setting a.edit-profit-setting").click(function(){t("table.profit-setting .profit-action").html('<input type="submit" value="保存" class="save-profit-setting">|        <a href="javascript:void(0)" class="edit-profit-setting" onclick="location.reload()">取消</a>'),t("table.profit-setting td.profit-val").each(function(){var e=t(this).attr("col-name"),i=t(this).find("em").html(),a=t('<input type="text"  name="'+e+'" value="'+i+'"/>');t(this).html(a)}),t("table.profit-setting td.profit-val input[type=text]").keypress(function(t){return a(t)}).focus(function(){this.style.imeMode="disabled"})}),t("form.update_profit_setting").submit(function(){var e=t(this).find("input[name=first_level]").val(),i=t(this).find("input[name=second_level]").val(),a=t(this).find("input[name=third_level]").val();return parseInt(e)+parseInt(i)+parseInt(a)>100?(alert("三级总和值不能超过100"),!1):!0}),t("input.setting-score-percent").click(function(){var e=parseInt(t("input.score-val").val());return t(this).is(":checked")&&0>=e?(alert("请输入比例值"),!1):void t(this).closest("form").submit()}),t(document).on("change","table.point-rules select.from",function(){o(t(this))}),t(document).on("change","table.point-rules select.to",function(){n(t(this))}),t(document).on("change","table.point-rules input.to",function(){l(t(this))}),t(".add-new-rule a").click(function(){var e=parseInt(t("input#max_profit_range").val()),i=parseInt(t("input#max_score_to").val()),a=t("table.point-rules"),o=t("<tr></tr>"),n=t("<td>"+(a.find("tbody tr").size()+1)+"</td>");o.append(n);var l=t('<input type="text" class="form-control number from score_from"  value="'+i+'" />'),s=t('<input type="text" class=" form-control number to score_to" value="'+(i+1)+'"/>'),c=t("<td></td>");c.append(l).append(" ~ ").append(s),o.append(c);var p=t('<select class="form-control select profit_range"></select>');r(p,0,e);var d=t("<td></td>");d.append(p),o.append(d);var u=t('<select class="form-control select profit_depth"></select>');r(u,1,3);var h=t("<td></td>");h.append(u),o.append(h);var m=t('<td><a href="javascript:void(0)" class="save-rule">保存</a> | <a href="javascript:void(0)" onclick="location.reload()">取消</a> </td>');o.append(m),a.find("tbody").append(o)}),t(document).on("click","table.point-rules a.edit-rule",function(){t(this).removeClass("edit-rule").addClass("save-rule").text("保存")}),t(document).on("click","table.point-rules a.save-rule",function(){var e=t(this).closest("tr"),i=e.find("input.score_from").val(),a=e.find("input.score_to").val(),o=e.find("select.profit_range").children("option:selected").val(),n=e.find("select.profit_depth").children("option:selected").val();t.ajax({url:"/distributor/save_or_update_rules",dataType:"json",method:"POST",data:{id:e.attr("score_id"),from:i,to:a,profit_range:o,profit_depth:n},success:function(t){1==t.state?location.reload():alert(t.msg)}})}),t("a.show_apply_list").click(function(){t("table.apply-list").show(),t("table.deal-list").hide(),t(this).addClass("on"),t("a.show_deal_list").removeClass("on")}),t("a.show_deal_list").click(function(){t("table.deal-list").show(),t("table.apply-list").hide(),t(this).addClass("on"),t("a.show_apply_list").removeClass("on")}),t("input.profit_money").bind("input propertychange",function(){var e=parseFloat(t("input.sale_price").val()),i=parseFloat(t(this).val());t(".in-price-percent em").html(t.formatFloat(i/e*100,2)),t("li.first-level-profit b").html("￥"+s(parseInt(t("li.first-level-profit").attr("val")),i)),t("li.second-level-profit b").html("￥"+s(parseInt(t("li.second-level-profit").attr("val")),i)),t("li.third-level-profit b").html("￥"+s(parseInt(t("li.third-level-profit").attr("val")),i))}),jQuery.extend({formatFloat:function(t,e){var i=parseFloat(t).toFixed(e);return i=i.toString().replace(/\$|\,/g,""),isNaN(i)&&(i="0"),sign=i==(i=Math.abs(i)),i=Math.floor(100*i+.50000000001),cents=i%100,i=Math.floor(i/100).toString(),cents<10&&(cents="0"+cents),(sign?"":"-")+i+"."+cents}}),t("#distributor_profit_chart").size()>0&&(t("#distributor_profit_chart").highcharts({chart:{type:"pie",options3d:{enabled:!0,alpha:45,beta:0},marginTop:0},title:{text:""},tooltip:{pointFormat:"{series.name}: <b>￥{point.y:.2f}</b>"},plotOptions:{pie:{allowPointSelect:!0,cursor:"pointer",depth:25,dataLabels:{enabled:!0,format:"{point.name}"}}},series:[{type:"pie",name:"分润额",data:[["三级分润",third_level_profit],["二级分润",second_level_profit],{name:"一级分润",y:first_level_profit,sliced:!0,selected:!0}]}]}),t("#distributor_profit_chart .highcharts-container").css({position:"absolute","margin-top":"-10px"})),t(".source-list li.add-li .li-text").mouseover(function(){t(this).hide(),t(".source-list li.add-li .add-link").show()}),t(".source-list li.add-li .add-link").mouseout(function(){t(this).hide(),t(".source-list li.add-li .li-text").show()}),t("#source-image").fileupload({url:mcmore.site_url+"/ajax/photo-upload",dataType:"json",formData:{},done:function(e,i){var a=i.result;console.info(a),t("#source-image").prev("button").html("已上传"),t("#source-image").next("input[type=hidden]").val(a.id)},progressall:function(e,i){var a=parseInt(i.loaded/i.total*5,10);t("#source-image").prev("button").html("上传中,已完成"+a+"%")}}),t(".source-list li.source").hover(function(){t(this).find("a.edit,a.delete").show()},function(){t(this).find("a.edit,a.delete").hide()}),t(document).on("click",".preview-image button.delete",function(){t(this).closest(".preview-image").remove(),t("input#source_content").val(""),$value="",t(".preview-image img").each(function(){$value+='<img src="'+t(this).attr("src")+'" image_id="'+t(this).attr("image_id")+'" />'}),t("input#source_content").val($value)}),t(".preview-image").hover(function(){t(this).find("button.delete").show()},function(){t(this).find("button.delete").hide()}),t("input[type=file].merchant_face_image").fileupload({autoUpload:!0,url:"/merchant/upload_image",dataType:"json",done:function(e,i){console.info(i);var a=i.result;1==a.state?t("input[type=file].merchant_face_image").prev("img").attr("src",a.msg):alert(a.msg)}}),t("header li.merchant_image").hover(function(){t(this).find("ul.son-menus").show()},function(){t(this).find("ul.son-menus").hide()});var p=t(".source-list ul");p.imagesLoaded(function(){p.masonry({itemSelector:"li",gutterWidth:20,isAnimated:!0})})}),jQuery(document).ready(function(t){function e(e,i,o){t("li",i).each(function(){var e=t(this);a(e.find(".tag-editor-tag").html(),groups)?e.removeClass("red-tag"):e.addClass("red-tag")})}function a(t,e){for(i in e)if(t==e[i])return!0;return!1}function o(e,i,a,o){t('.groups-list input[data-val="'+o+'"]').prop("checked",!1)}function n(e,i,a,o,n){t('.groups-list input[data-val="'+n+'"]').prop("checked",!0)}t("#groups-field").size()&&(t("#groups-field").tagEditor({autocomplete:{delay:0,position:{collision:"flip"},source:groups},delimiter:",，",placeholder:"输入用户组，多个组以逗号分隔。也可以直接点击右边列表的复选项目选择",onChange:e,beforeTagSave:n,beforeTagDelete:o}),e(null,t("#groups-field").tagEditor("getTags")[0].editor),t(".groups-list input").click(function(){t(this).prop("checked")?t("#groups-field").tagEditor("addTag",t(this).data("val")):t("#groups-field").tagEditor("removeTag",t(this).data("val"))}),t(".group-keyword").keyup(function(){var e=t(this).val();t(".groups-list tr").each(function(){t(this).data("val").indexOf(e)>=0||""==e?t(this).show():t(this).hide()})}),t(".clear-keyword").click(function(){t(".group-keyword").val(""),t(".groups-list tr").show()}))});var uploadPreview=function(t){var e=this;e.IsNull=function(t){return"function"==typeof t?!1:void 0==t||null==t||""==t||0==t.length?!0:!1},e.DefautlSetting={UpBtn:"",DivShow:"",DivFile:"",FileInput:"",ImgClass:"",FileName:"",MaxSize:10,Width:100,Height:100,ImgType:["gif","jpeg","jpg","bmp","png"],ErrMsg:"选择文件错误,图片类型必须是(gif,jpeg,jpg,bmp,png)中的一种",callback:function(){}},e.Setting={UpBtn:e.IsNull(t.UpBtn)?e.DefautlSetting.UpBtn:t.UpBtn,DivShow:e.IsNull(t.DivShow)?e.DefautlSetting.DivShow:t.DivShow,DivFile:e.IsNull(t.DivFile)?e.DefautlSetting.DivFile:t.DivFile,FileInput:e.IsNull(t.FileInput)?e.DefautlSetting.FileInput:t.FileInput,ImgClass:e.IsNull(t.ImgClass)?e.DefautlSetting.ImgClass:t.ImgClass,FileName:e.IsNull(t.FileName)?e.DefautlSetting.FileName:t.FileName,MaxSize:e.IsNull(t.MaxSize)?e.DefautlSetting.MaxSize:t.MaxSize,Width:e.IsNull(t.Width)?e.DefautlSetting.Width:t.Width,Height:e.IsNull(t.Height)?e.DefautlSetting.Height:t.Height,ImgType:e.IsNull(t.ImgType)?e.DefautlSetting.ImgType:t.ImgType,ErrMsg:e.IsNull(t.ErrMsg)?e.DefautlSetting.ErrMsg:t.ErrMsg,callback:e.IsNull(t.callback)?e.DefautlSetting.callback:t.callback},e.getObjectURL=function(t){var e=null;return void 0!=window.createObjectURL?e=window.createObjectURL(t):void 0!=window.URL?e=window.URL.createObjectURL(t):void 0!=window.webkitURL&&(e=window.webkitURL.createObjectURL(t)),e},e.Bind=function(){$(document).on("change","#"+e.Setting.UpBtn,function(){if($("#"+e.Setting.DivShow+" img").size()>=e.Setting.MaxSize)return alert("最多同时上传"+e.Setting.MaxSize+"张图片!"),!1;if(this.value){if(!RegExp(".("+e.Setting.ImgType.join("|")+")$","i").test(this.value.toLowerCase()))return alert(e.Setting.ErrMsg),this.value="",!1;
    if(navigator.userAgent.indexOf("MSIE")>-1)
        try{
            var t=$('<div class="image-list"><img class="'+e.Setting.ImgClass+'" src="'+e.getObjectURL(this.files[0])+'" width="'+e.Setting.Width+'" height="'+e.Setting.Height+'"/></div>');
            $("#"+e.Setting.DivShow).append(t),$(this).removeAttr("id").attr("name",e.Setting.FileName),
                $(this).appendTo($("#"+e.Setting.DivFile)),$(".file-area").append($('<input type="file" name="image" id="upload-image-source-input" multiple />'))}
        catch(i){
            $image_list=$('<div class="'+e.Setting.ImgClass+'"></div>'),this.select(),top.parent.document.body.focus();var a=document.selection.createRange().text;document.selection.empty(),$image_list.css({filter:"progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale)",width:e.Setting.Width+"px",height:e.Setting.Height+"px"}),$image_list.item("DXImageTransform.Microsoft.AlphaImageLoader").attr("src",a),$("#"+e.Setting.DivShow).append($image_list),$(this).removeAttr("id").attr("name",e.Setting.FileName),$(this).appendTo($("#"+e.Setting.DivFile)),$(".file-area").append($('<input type="file" name="image" id="upload-image-source-input" multiple />'))
        }
    else{
        var t=$('<div class="image-list"><img class="'+e.Setting.ImgClass+'" src="'+e.getObjectURL(this.files[0])+'" width="'+e.Setting.Width+'" height="'+e.Setting.Height+'"/></div>');$("#"+e.Setting.DivShow).append(t),$(this).removeAttr("id").attr("name",e.Setting.FileName),$(this).appendTo($("#"+e.Setting.DivFile)),$(".file-area").append($('<input type="file" name="image" id="upload-image-source-input" multiple />'))
    }
    e.Setting.callback()}})},e.Bind()};